{% extends 'Base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/ManageOrders.css' %}">
{% endblock %}
{% block content %}
<section id="manage-order-section">
    <div class="container mt-5">
        <div class="order-status-container">
            {% with placed=0 shipped=0 completed=0 cancelled=0 %}
                {% for order in orders %}
                    {% if order.OrderStatus == "Placed" %}
                        {% with placed=placed|add:1 %}
                        {% endwith %}
                    {% elif order.OrderStatus == "Shipped" %}
                        {% with shipped=shipped|add:1 %}
                        {% endwith %}
                    {% elif order.OrderStatus == "Completed" %}
                        {% with completed=completed|add:1 %}
                        {% endwith %}
                    {% elif order.OrderStatus == "Cancelled" %}
                        {% with cancelled=cancelled|add:1 %}
                        {% endwith %}
                    {% endif %}
                {% endfor %}
                <div class="order-status-box">Order Placed: {{ placed }}</div>
                <div class="order-status-box">Order Shipped: {{ shipped }}</div>
                <div class="order-status-box">Order Completed: {{ completed }}</div>
                <div class="order-status-box">Order Cancelled: {{ cancelled }}</div>
            {% endwith %}
        </div>

        <section class="orders-section">
            <h2 class="text-center mb-4">ORDERS MANAGEMENT</h2>
            <div class="orders-header">
                <button class="sort-button">Sort by</button>
                <input type="text" id="search-bar" placeholder="Search by Order ID" class="search-bar">
            </div>
            <table class="table table-striped orders-table">
                <thead>
                    <tr>
                        <th>Order ID</th>
                        <th>Item</th>
                        <th>Quantity</th>
                        <th>Supplier Name</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="orders-table-body">
                    {% for order in orders %}
                    <tr>
                        <td>{{ order.Order_ID }}</td>
                        <td>{{ order.Items.ItemName }}</td>
                        <td>{{ order.Quantity }}</td>
                        <td>{{ order.Supplier.SupplierName }}</td>
                        <td>{{ order.OrderStatus }}</td>
                        <td>
                            <button 
                                type="button" 
                                class="btn btn-primary change-status-btn" 
                                data-bs-toggle="modal" 
                                data-bs-target="#changeStatusModal" 
                                data-order-id="{{ order.Order_ID }}" 
                                data-current-status="{{ order.OrderStatus }}">
                                Change Status
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </section>
    </div>
</section>

<!-- Modal for Changing Status -->
<div class="modal fade" id="changeStatusModal" tabindex="-1" aria-labelledby="changeStatusModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="POST" action="{% url 'ManageOrder' %}">
                {% csrf_token %}
                <div class="modal-header">
                    <h5 class="modal-title" id="changeStatusModalLabel">Change Order Status</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="order_id" id="modal-order-id">
                    <p>Current Status: <strong id="modal-current-status"></strong></p>
                    <label for="new-status">Select New Status:</label>
                    <select name="new_status" id="new-status" class="form-select">
                        <option value="Placed">Placed</option>
                        <option value="Shipped">Shipped</option>
                        <option value="Completed">Completed</option>
                        <option value="Cancelled">Cancelled</option>
                    </select>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="{% static 'js/ManageOrders.js' %}"></script>
{% endblock %}